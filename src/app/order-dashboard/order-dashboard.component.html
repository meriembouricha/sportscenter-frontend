<div class="orders-container">
  <div class="header">
    <h2>Gestion des Commandes</h2>
  </div>

  <table class="table orders-table">
    <thead>
      <tr>
        <th>ID Commande</th>
        <th>Utilisateur</th>
        <th>Statut de Livraison</th>
        <th>Montant Total</th>
        <th>Frais de Livraison</th>
        <th>Détails</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let order of paginatedOrders">
        <tr>
          <td>{{ order.id }}</td>
          <td>
            <strong>{{ order.username }}</strong><br />
            <small class="text-muted">{{ order.userEmail }}</small>
          </td>
          <td>
            <span [ngClass]="getStatusClass(order.deliveryStatus)">
              {{ getStatusLabel(order.deliveryStatus) }}
            </span>
          </td>
          <td>{{ order.totalAmount / 100 | currency: 'EUR' }}</td>
          <td>{{ order.shippingPrice / 100 | currency: 'EUR' }}</td>
          <td>
            <button class="btn btn-outline-secondary btn-sm" (click)="toggleExpand(order.id)">
              {{ expandedOrderId === order.id ? 'Réduire' : 'Afficher' }}
            </button>
          </td>
        </tr>

        <tr *ngIf="expandedOrderId === order.id">
          <td colspan="6">
            <div class="collapse-section mt-3">
              <h5>Produits commandés :</h5>
              <table class="table table-sm table-bordered">
                <thead>
                  <tr>
                    <th>Produit</th>
                    <th>Prix</th>
                    <th>Quantité</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of order.items">
                    <td>{{ item.productName }}</td>
                    <td>{{ item.productPrice / 100 | currency: 'EUR' }}</td>
                    <td>{{ item.quantity }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <div class="pagination-controls d-flex justify-content-between align-items-center mt-3">
    <button class="btn btn-outline-primary" (click)="loadPreviousPage()" [disabled]="currentPage === 0">Précédent</button>
    <span>Page {{ currentPage + 1 }} sur {{ totalPages }}</span>
    <button class="btn btn-outline-primary" (click)="loadNextPage()" [disabled]="currentPage === totalPages - 1">Suivant</button>
  </div>
</div>
